<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Káva u Ondry a Anet</title>
  <style>
    /* Basic reset */
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, #f8f1e7, #e9dfd1);
      color: #2f241f;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a { color: inherit; text-decoration: none; }
    h1, h2, h3 { margin: 0; }
    button { cursor: pointer; }

    /* Top bar */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(47, 36, 31, 0.92);
      color: #f7f3ed;
      backdrop-filter: blur(8px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
    }
    .topbar-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      gap: 16px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .brand-mark {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, #c49b63, #7a5230);
      display: grid;
      place-items: center;
      color: #fdf9f3;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .brand-text small { opacity: 0.8; }

    .login {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px;
      padding: 8px 12px;
    }
    .login input {
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.2);
      color: #f7f3ed;
      padding: 8px 10px;
      border-radius: 8px;
      outline: none;
      min-width: 120px;
    }
    .login button {
      background: linear-gradient(135deg, #f4c27c, #d89b58);
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      color: #2f241f;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }
    .login-status {
      font-size: 12px;
      opacity: 0.85;
    }

    /* Layout */
    .hero {
      max-width: 1200px;
      margin: 32px auto 0;
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 28px;
      padding: 0 20px 32px;
    }
    .card {
      background: rgba(255,255,255,0.85);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.1);
      border: 1px solid rgba(0,0,0,0.04);
      overflow: hidden;
    }
    .card-header {
      padding: 18px 20px 10px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }
    .card-header h2 { font-size: 22px; }
    .card-header small { color: #5e5048; }
    .card-body { padding: 0 20px 20px; }

    /* Customer */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 14px;
    }
    .input-group label {
      font-weight: 600;
      color: #4b3d35;
    }
    .input-group input, .input-group select, .input-group textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #d6c9be;
      background: #fffdfa;
      font-size: 15px;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
    }
    .input-group textarea { min-height: 80px; resize: vertical; }
    .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
      border-color: #c49b63;
      box-shadow: 0 0 0 3px rgba(196,155,99,0.15);
    }

    /* Coffee grid */
    .coffee-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 14px;
      margin: 12px 0 8px;
    }
    .coffee-card {
      position: relative;
      padding: 14px;
      border-radius: 14px;
      background: linear-gradient(160deg, #fdf8f2, #f0e4d6);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.8), 0 8px 16px rgba(0,0,0,0.08);
      border: 1px solid rgba(196,155,99,0.2);
    }
    .coffee-hero {
      height: 140px;
      border-radius: 12px;
      margin-bottom: 10px;
      background-size: cover;
      background-position: center;
      box-shadow: 0 12px 24px rgba(0,0,0,0.18);
    }
    .coffee-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-weight: 700;
      color: #3c2f28;
    }
    .coffee-desc {
      font-size: 13px;
      color: #6c5b50;
      margin-bottom: 10px;
      min-height: 36px;
    }
    .coffee-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .tag {
      background: rgba(196,155,99,0.18);
      border-radius: 999px;
      padding: 6px 10px;
      color: #7a5230;
      font-weight: 700;
      font-size: 12px;
    }
    .btn {
      border: none;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 700;
      transition: transform 0.15s, box-shadow 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #c49b63, #8c6239);
      color: #fffaf2;
      box-shadow: 0 8px 16px rgba(140,98,57,0.35);
      width: 100%;
    }
    .btn-primary:hover { transform: translateY(-1px); }
    .btn-ghost {
      background: transparent;
      color: #7a5230;
      border: 1px solid rgba(122,82,48,0.4);
      padding: 8px 10px;
    }

    /* Options row */
    .options-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin: 10px 0 14px;
    }

    /* Orders */
    .orders {
      max-width: 1200px;
      margin: 0 auto 32px;
      padding: 0 20px 28px;
    }
    .order-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .order-item {
      background: rgba(255,255,255,0.9);
      border-radius: 14px;
      padding: 14px;
      border: 1px solid rgba(0,0,0,0.04);
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }
    .order-main { display: flex; flex-direction: column; gap: 4px; }
    .order-meta { color: #6c5b50; font-size: 13px; display: flex; gap: 10px; flex-wrap: wrap; }
    .order-actions { display: flex; align-items: center; gap: 8px; }
    .badge { padding: 6px 10px; border-radius: 999px; font-weight: 700; font-size: 12px; }
    .badge-wip { background: rgba(92, 143, 255, 0.16); color: #1f4fbf; }
    .badge-done { background: rgba(76, 175, 80, 0.18); color: #2b7a31; }
    .badge-new { background: rgba(196,155,99,0.2); color: #7a5230; }
    .small {
      font-size: 12px;
      color: #5e5048;
      opacity: 0.9;
    }
    .divider { border-top: 1px solid rgba(0,0,0,0.06); margin: 14px -20px 0; }
    .hidden { display: none !important; }

    @media (max-width: 900px) {
      .hero { grid-template-columns: 1fr; }
      .topbar-inner { flex-wrap: wrap; }
      .login { width: 100%; }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-mark">KÁVA</div>
        <div class="brand-text">
          <strong>Obývák Ondry &amp; Anet</strong>
          <small>Domácí barista zážitek</small>
        </div>
      </div>
      <div class="login">
        <input id="user" type="text" placeholder="Uživatel (Ondrej / Anet)" />
        <input id="pass" type="password" placeholder="Heslo" />
        <button id="loginBtn">Přihlásit</button>
        <div class="login-status" id="loginStatus">Nepřihlášen</div>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="card" id="orderCard">
        <div class="card-header">
          <h2>Objednávka kávy</h2>
          <small>Všechny kávy zdarma</small>
        </div>
        <div class="card-body">
          <div class="input-group">
            <label for="customer">Jméno zákazníka</label>
            <input id="customer" type="text" placeholder="Např. Jana Nováková" />
          </div>

          <div class="options-row">
            <div class="input-group">
              <label for="milk">Mléko</label>
              <select id="milk">
                <option value="bez mléka">Bez mléka</option>
                <option value="plnotučné">Plnotučné</option>
                <option value="polotučné">Polotučné</option>
                <option value="ovesné">Ovesné</option>
                <option value="mandlové">Mandlové</option>
              </select>
            </div>
            <div class="input-group">
              <label for="sugar">Počet lžiček cukru</label>
              <input id="sugar" type="number" min="0" max="5" value="1" />
            </div>
          </div>

          <div class="input-group">
            <label for="note">Extra požadavek</label>
            <textarea id="note" placeholder="Bez pěny, více mléka, přinést s cookies..."></textarea>
          </div>

          <div class="input-group">
            <label>Kávy k výběru</label>
            <div class="coffee-grid" id="coffeeGrid"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>Aktuální stav</h2>
          <small id="baristaState">Nepřihlášený barista</small>
        </div>
        <div class="card-body">
          <p class="small">Přihlášení Ondra/Anet mohou objednávky převzít a dokončit.</p>
          <div class="divider"></div>
          <div class="orders">
            <div class="order-list" id="orders"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const coffees = [
      { name: "Latte Macchiato", desc: "Jemné vrstvení espressa a mléka.", img: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=900&q=80" },
      { name: "Cappuccino", desc: "Vyvýšená pěna, kakao a sametová chuť.", img: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=900&q=80&sat=-10" },
      { name: "Café Au Lait", desc: "Káva s teplým mlékem ve francouzském stylu.", img: "https://images.unsplash.com/photo-1511920170033-f8396924c348?auto=format&fit=crop&w=900&q=80" },
      { name: "Espresso", desc: "Intenzivní shot pro ranní nakopnutí.", img: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=900&q=80" },
      { name: "Lungo", desc: "Delší extrakce, jemnější tělo.", img: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=900&q=80&sat=-20" },
      { name: "Logr", desc: "Poctivá česká klasika tak, jak ji máme rádi.", img: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=900&q=80&sat=10" },
      { name: "Rozpustné kafe", desc: "Rychlé, pohodlné, kdykoli připravené.", img: "https://images.unsplash.com/photo-1510626176961-4b37d0b4e904?auto=format&fit=crop&w=900&q=80" },
      { name: "Caro", desc: "Oblíbený bezkofeinový nápoj pro každý okamžik.", img: "https://images.unsplash.com/photo-1459257868276-5e65389e2722?auto=format&fit=crop&w=900&q=80" },
    ];

    const coffeeGrid = document.getElementById("coffeeGrid");
    const ordersEl = document.getElementById("orders");
    const baristaState = document.getElementById("baristaState");
    const statusEl = document.getElementById("loginStatus");
    const userEl = document.getElementById("user");
    const passEl = document.getElementById("pass");

    let loggedIn = null; // "Ondrej" | "Anet" | null
    let orders = [];

    // Konfigurace pro provoz na NAS: ponech default FALSE (localStorage).
    // Pokud připravíš jednoduché API na Synology (např. PHP/Node), nastav REMOTE_API=true
    // a API_BASE na cestu, kde GET vrací JSON objednávek a POST/PUT je uloží.
    const REMOTE_API = true;
    // Přímá adresa na PHP endpoint (nepřidává se už /orders)
    const API_URL = "http://192.168.0.242/kavarna-api/orders.php";
    const STORAGE_KEY = "kavarna-ondry-anet-orders";

    const saveLocal = () => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
    };

    const loadLocal = () => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        orders = parsed.map(o => ({
          ...o,
          created: new Date(o.created),
          start: o.start ? new Date(o.start) : undefined,
        }));
      } catch (e) {
        console.warn("Nepodařilo se načíst uložené objednávky", e);
      }
    };

    const saveRemote = async () => {
      try {
        await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ orders }),
        });
      } catch (e) {
        console.warn("Uložení na server selhalo, ponechávám lokální stav", e);
      }
    };

    const loadRemote = async () => {
      try {
        const res = await fetch(API_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        if (!Array.isArray(data.orders)) return;
        orders = data.orders.map(o => ({
          ...o,
          created: new Date(o.created),
          start: o.start ? new Date(o.start) : undefined,
        }));
      } catch (e) {
        console.warn("Načtení ze serveru selhalo, zkusím lokální úložiště", e);
        loadLocal();
      }
    };

    const saveOrders = () => {
      if (REMOTE_API) {
        saveRemote();
      } else {
        saveLocal();
      }
    };

    const loadOrders = async () => {
      if (REMOTE_API) {
        await loadRemote();
      } else {
        loadLocal();
      }
    };

    const createCoffeeCard = (coffee) => {
      const card = document.createElement("div");
      card.className = "coffee-card";
      card.innerHTML = `
        <div class="coffee-hero" style="background-image:url('${coffee.img}')"></div>
        <div class="coffee-title">
          <span>${coffee.name}</span>
          <span class="tag">Zdarma</span>
        </div>
        <div class="coffee-desc">${coffee.desc}</div>
        <div class="coffee-actions">
          <button class="btn btn-primary" data-order="${coffee.name}">Objednat</button>
        </div>
      `;
      const orderBtn = card.querySelector("[data-order]");
      orderBtn.addEventListener("click", () => handleOrder(coffee.name, true));
      return card;
    };

    coffees.forEach(c => coffeeGrid.appendChild(createCoffeeCard(c)));

    document.getElementById("loginBtn").addEventListener("click", () => {
      const u = userEl.value.trim();
      const p = passEl.value.trim();
      if ((u === "Ondrej" && p === "1711") || (u === "Anet" && p === "Sunny")) {
        loggedIn = u;
        statusEl.textContent = "Přihlášen: " + u;
        baristaState.textContent = "Barista: " + u;
        statusEl.style.color = "#c4ffab";
        updateLayout();
      } else {
        loggedIn = null;
        statusEl.textContent = "Chybné údaje";
        statusEl.style.color = "#ffd6d6";
        updateLayout();
      }
    });

    function handleOrder(coffeeName, direct = false) {
      const customer = document.getElementById("customer").value.trim();
      if (!customer) {
        alert("Vyplň prosím jméno zákazníka.");
        return;
      }
      const milk = document.getElementById("milk").value;
      const sugar = document.getElementById("sugar").value;
      const note = document.getElementById("note").value.trim();
      const now = new Date();
      const order = {
        id: crypto.randomUUID(),
        customer,
        coffee: coffeeName,
        milk,
        sugar,
        note,
        created: now,
        status: "new", // new | wip | done
        by: null,
        duration: null,
      };
      orders = [order, ...orders];
      renderOrders();
      saveOrders();
      if (direct) alert("Objednávka přidána: " + coffeeName);
    }

    function renderOrders() {
      ordersEl.innerHTML = "";
      if (!orders.length) {
        const empty = document.createElement("div");
        empty.className = "small";
        empty.textContent = "Zatím žádné objednávky.";
        ordersEl.appendChild(empty);
        return;
      }
      orders.forEach(order => {
        const container = document.createElement("div");
        container.className = "order-item";
        const statusBadge = order.status === "done"
          ? "badge badge-done"
          : order.status === "wip"
            ? "badge badge-wip"
            : "badge badge-new";

        const metaTime = order.created.toLocaleString("cs-CZ");
        container.innerHTML = `
          <div class="order-main">
            <strong>${order.customer}</strong>
            <div>${order.coffee} • ${order.milk} • ${order.sugar} lžiček cukru</div>
            ${order.note ? `<div class="small">Poznámka: ${order.note}</div>` : ""}
            <div class="order-meta">
              <span>${metaTime}</span>
              <span>${order.duration ? "Doba přípravy: " + order.duration + " min" : "Čeká na přípravu"}</span>
              <span>${order.by ? "Barista: " + order.by : "Nepřiřazeno"}</span>
            </div>
          </div>
          <div class="order-actions">
            <span class="${statusBadge}">${order.status === "done" ? "Hotovo" : order.status === "wip" ? "Rozpracováno" : "Nové"}</span>
            ${order.status !== "done" ? `<button class="btn-ghost" data-action="take">Vzít</button>` : ""}
            ${order.status === "wip" ? `<button class="btn btn-primary" data-action="done">Hotovo</button>` : ""}
          </div>
        `;

        container.querySelectorAll("button").forEach(btn => {
          btn.addEventListener("click", () => {
            if (!loggedIn) {
              alert("Pro práci s objednávkami se přihlas (Ondrej/Anet).");
              return;
            }
            if (btn.dataset.action === "take") {
              order.status = "wip";
              order.by = loggedIn;
              order.start = new Date();
            }
            if (btn.dataset.action === "done") {
              order.status = "done";
              order.by = order.by || loggedIn;
              const now = new Date();
              const minutes = order.start ? ((now - order.start) / 60000).toFixed(1) : "0.0";
              order.duration = minutes;
            }
            renderOrders();
            saveOrders();
          });
        });

        ordersEl.appendChild(container);
      });
    }

    function updateLayout() {
      const orderCard = document.getElementById("orderCard");
      if (loggedIn) {
        orderCard.classList.add("hidden");
      } else {
        orderCard.classList.remove("hidden");
      }
    }

    loadOrders();
    renderOrders();
    updateLayout();
  </script>
</body>
</html>

